При оценке состояния системы предполагается наличие измерений, связанных с вектором состояния $\vec{x}$.
Если состояние измеряется напрямую (например, звёздными трекерами), то дополнительной информации не требуется.
Но большинство датчиков (солнечные сенсоры, магнитометры, сенсоры горизонта) измеряют вектор в трехмерном пространстве.
В общем случае измерение $\vec{y_k}$ описывается нелинейным уравнением вида:
$$
\bar{y_k}=h(\vec{x_k})+\nu_k
$$
где: $h(x_k)$ - нелинейная функция состояния,
	$\nu_k$ - шум измерений.
	$\bar{y_k}$ - вектор измерений на дискретном шаге $k$
> [!definition] Пример
> Если солнечный сенсор измеряет направление на Солнце в теле КА, то $\vec{h}(\vec{x_k})$ - это поворот вектора солнца из инерциальной системы в телесную через ориентацию, заданную кватернионом.

> 
### Линеаризация измерений
Для применения фильтров типа **калмановскаого (EKF,UKF)** часто требуется **линеаризировать** модель измерений:
$$
\bar{y}_k = {\bf h}_k\vec{x}_k + \vec{\nu}_k
$$
где ${\bf h}_k = \partial \vec{h}/\partial \vec{x}$. - якобиан функции измерений $\vec{h}$ по переменной состояния $\vec{x}$, вычисленный в текщей точке.
	$\vec{\nu_k}$- белый гаусовский шум с ковариацией:
$$
 cov(\vec{\nu}_k) = {\bf E}(\vec{\nu}_k\vec{\nu}_k^T) = {\bf R}_k
$$
		где $\bf{R}_k$ - ковариационная матрица шума (обычно известна или колибруется заранее) 
Для звездного трекера, измеряющего оринтацию напрямую:
$$
h(\vec{x_k})=\vec{x_k} => \bf{h} = \bf{I}
$$
где $\bf{I}$ - единичная матрица

### Измерение вектора онтносительно инерциальной системы
Если, например, солнечный вектор измеряет вектор $\vec{r}$ в теле КА, а его значение в инерциальной системе $\vec{r}^I$ известно зараенее (из эфемерид), то измерения моделируется так:
$$
	\bar{r_k}^B=\bf{T}_{BI}(\vec{q_k})\vec{r_k}^I+\vec{\nu_k}
$$
где:
	$\vec{r_k}^B$ - измерения в телесной системе
	$\bf{T}_{BI}(\vec{q_k})$ - матрица поворота из инерциальной системы в телесную, зависящая от кватерниона ориентации $\vec{q}_k$
	$\vec{r_k}^I$ - известный вектор в инерциальной системе координат

### Модель гироскопа
Гироскоп измеряет угловую скорость, но его измерения, как правило, содержат **смещение** и шум:
$$
\bar{\omega_k}=\vec{\omega_k}+\vec{b_k}+\vec{\nu}_{g,k}
$$
где:
	$\vec{\omega}_k$ - истинная угловая скорость
	$\vec{b}_k$- смещение (bias) медленное изменяющееся во времени
	$\vec{\nu}_{g,k}$ - белый гауссовский шум
Смещение моделируеся как случайный процесс:
$$
	\dot{\vec{b}_k} = \vec{\nu}_{b,k}
$$
**Оценка истинной угловой скорости** осуществялется с учётом аппроксимации смещения:
$$
	\bar{\omega}_k=\bar{\omega_k}-\bar{b}_k
$$
где $\bar{b}_k$ - оценка смещения, полученная, например из фильтра Калмана.

## Метод наименьших квадратов и связь с фильтром Калмана

Постановка задачи:
Пусть мы имеем $\bf{M}$ независимых измерений:
$$
\bar{Y} = [\bar{y}_1,\bar{y}_2,...,\bar{y}_M ]^T
$$

и модель:
$$
\bar{Y} = \bf{H} \vec{x}+\vec{V}
$$
где:
	$\vec{x}$ -вектор незвестных (например, парметров модели или состояния)
	$\bf{H}$ - матрица, описывающая зависимость измерений от неизвестных,
	$\vec{V}$ - вектор ошибок (разности между измерениями и модельными значениями)
	$\bar{Y}$ - измеренные значения
Если бы не было шума и ошибок модели - существовало бы точное решение:
$$
\bar{Y}=\bf {H}\vec{x}
$$
Но из-за шума такая система обычно **переопределена**: измерений больше, чем неизвестных $(M > N)$, и нет решения, которе бы удовлетворяло всем уравнениям точно.

### Геометрическая инерпритация
На рисунке представлена задача линейной регресии. Черные точки - это измерения $\tilde{Y}$, красная линия - оценка $\bar{Y}=\bf{H}\vec{x}$, остатки (residuals) - расстояния между точками и линией:
$$
\hat{Y} = \tilde{Y} - \bar{Y}
$$
![[Linear_Regression.png]]

### Метод наименьших квадратов
Чтобы найти приближенное решение минимизируют сумму квадратов остатков:
$$
J=\frac{1}{2}\hat{Y}^T\hat{Y}
$$
Подставляя $\hat{Y}=\bar{Y}-\bf{H}\tilde{x}$, получаем:
